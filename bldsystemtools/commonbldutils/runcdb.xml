<?xml version="1.0"?>
<!DOCTYPE Build  [
  <!ELEMENT Product (Commands)>
  <!ATTLIST Product name CDATA #REQUIRED>
  <!ELEMENT Commands (Execute+ | SetEnv*)>
  <!ELEMENT Execute EMPTY>
  <!ATTLIST Execute ID CDATA #REQUIRED>
  <!ATTLIST Execute Stage CDATA #REQUIRED>
  <!ATTLIST Execute Component CDATA #REQUIRED>
  <!ATTLIST Execute Cwd CDATA #REQUIRED>
  <!ATTLIST Execute CommandLine CDATA #REQUIRED>
  <!ELEMENT SetEnv EMPTY>
  <!ATTLIST SetEnv Order ID #REQUIRED>
  <!ATTLIST SetEnv Name CDATA #REQUIRED>
  <!ATTLIST SetEnv Value CDATA #REQUIRED>
]>
<Product Name="Run imreport script">
  <Commands>
    <!-- Set Env -->
    <!-- Most variables will have been set in the BuildLaunch xml -->
    <SetEnv Order="1" Name="PATH" Value="%Sourcedir%\os\buildtools\devlib\devlibhelp\tools\buildrefdoc\dist;%PATH%"/>
    <Execute ID="1" Stage="2" Component="Copy System_Definition.xml" Cwd="%SourceDir%" CommandLine="xcopy %EPOCROOT%epoc32\data\System_Definition.xml %SourceDir%\os\buildtools\bldsystemtools\buildsystemtools\ /Z /I /Q"/>
    <!-- Run doxygen and the imreport 4 times -->
    <Execute ID="2" Stage="2" Component="Run buildrefdoc 1" Cwd="%SourceDir%" CommandLine="buildrefdoc -F -E -C -b --share=1/4 --config=&quot;GT_%BuildShortName%&quot; --codeline=%Sourcedir% \doxyref"/>
    <Execute ID="3" Stage="2" Component="Run buildrefdoc 2" Cwd="%SourceDir%" CommandLine="buildrefdoc -F -E -C -b --share=2/4 --config=&quot;GT_%BuildShortName%&quot; --codeline=%Sourcedir% \doxyref"/>
    <Execute ID="4" Stage="2" Component="Run buildrefdoc 3" Cwd="%SourceDir%" CommandLine="buildrefdoc -F -E -C -b --share=3/4 --config=&quot;GT_%BuildShortName%&quot; --codeline=%Sourcedir% \doxyref"/>
    <Execute ID="5" Stage="2" Component="Run buildrefdoc 4" Cwd="%SourceDir%" CommandLine="buildrefdoc -F -E -C -b --share=4/4 --config=&quot;GT_%BuildShortName%&quot; --codeline=%Sourcedir% \doxyref"/>
    <Execute ID="6" Stage="3" Component="Run reporter" Cwd="%BuildDir%" CommandLine="imrepgen.exe --build=%BuildNumber% \doxyref\stats %LogsDir%\imrep_%BuildNumber%.xml >%LogsDir%\imreport.log 2>&amp;1"/>
    <!-- Run 'cdb extract...' on the GXP files to populate this build's CDB -->
    <Execute ID="7" Stage="4" Component="Extract GT+TV+Java Info" Cwd="%BuildDir%" CommandLine="%SourceDir%\os\buildtools\bldsystemtools\commonbldutils\cdb_sysbuild -d %BuildDir%\cdb-info\cdb.db  -t %BuildDir%\epoc32\ extractrelease %BuildNumber% -a %LogsDir%\imrep_%BuildNumber%.xml 2>&amp;1"/>
    <Execute ID="8" Stage="5" Component="Publish CDB" Cwd="%BuildDir%" CommandLine="xcopy %BuildDir%\cdb-info\cdb.db.* %PublishLocation%\%Type%\%BuildNumber%\cdb-info /z/e/i/q"/>

    <!-- Run 'cdb compare...'  -->

    <Execute ID="9" Stage="6" Component="Make local copy of Previous CDB files" Cwd="%BuildDir%" CommandLine="perl %SourceDir%\os\buildtools\bldsystemtools\commonbldutils\bxcopy.pl -s %PreviousBuildPublishLocation%\%Type%\%CDBPreviousBuildNumber%\cdb-info\ -t %BuildDir%\cdb-prev-info -i \cdb.db.* -x \.xml  -x \.html"/>
    <Execute ID="10" Stage="7" Component="BC Compare with Previous" Cwd="%BuildDir%" CommandLine="%SourceDir%\os\buildtools\bldsystemtools\commonbldutils\cdb_sysbuild -d %BuildDir%\cdb-prev-info\cdb.db comparerelease %CDBPreviousBuildNumber% %BuildNumber% -r %BuildDir%\cdb-info\BC-prev.xml -a %BuildDir%\cdb-info\cdb.db -f publishedPartner 2>&amp;1"/>

    <!-- Run 'cdb compare...'  -->
    <Execute ID="11" Stage="8" Component="Make local copy of Base CDB files" Cwd="%BuildDir%" CommandLine="perl %SourceDir%\os\buildtools\bldsystemtools\commonbldutils\bxcopy.pl -s %PreviousBuildPublishLocation%\%Type%\%BaseBuildNumber%\cdb-info\ -t %BuildDir%\cdb-base-info -i \cdb.db.* -x \.xml  -x \.html"/>
    <Execute ID="12" Stage="9" Component="BC Compare with Baseline" Cwd="%BuildDir%" CommandLine="%SourceDir%\os\buildtools\bldsystemtools\commonbldutils\cdb_sysbuild -d %BuildDir%\cdb-base-info\cdb.db comparerelease %BaseBuildNumber% %BuildNumber% -r %BuildDir%\cdb-info\BC-base.xml -a %BuildDir%\cdb-info\cdb.db -f publishedPartner 2>&amp;1"/>

  </Commands>
</Product>
